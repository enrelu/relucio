---
// 1. IMPORTACIONES
import Layout from '../layouts/Layout.astro';
import Section from '../components/Section.astro';
import ProjectCard from '../components/ProjectCard.astro';
import ExpandableItem from '../components/ExpandableItem.astro'; // <--- IMPORTANTE
import BlogRow from '../components/BlogRow.astro';
import { getCollection } from 'astro:content';

// 2. DATOS DE PROYECTOS Y EXPERIENCIA
// PROYECTOS (Añadido campo 'details' con texto extendido)
const projects = [
  {
    id: "proj-1",
    title: "Servicio Virtual CISO",
    category: "consultoria",
    client: "Hispasat",
    summary: "Gestión de riesgos y coordinación de seguridad integral.",
    details: `Responsable de la definición del Plan Director de Seguridad alineado con los objetivos de negocio. Implantación de normativas ISO 27001 y Esquema Nacional de Seguridad (ENS).

    Supervisión directa de auditorías internas y gestión de incidentes críticos, actuando como enlace principal entre el equipo técnico y el comité de dirección.`,
    year: "2022"
  },
  {
    id: "proj-2",
    title: "Auditoría de Seguridad OT",
    category: "consultoria",
    client: "Grupo Mahou San Miguel",
    summary: "Evaluación de vulnerabilidades en infraestructura industrial.",
    details: `Ejecución de pentesting en entornos SCADA/ICS bajo la normativa IEC 62443 sin afectar la disponibilidad de la planta. 
    
    Elaboración de informes de impacto de negocio y roadmap de remediación para segregar redes IT/OT y securizar accesos remotos de proveedores.`,
    year: "2021"
  },
  {
    id: "proj-3",
    title: "Integración RAN & IP",
    category: "consultoria",
    client: "Huawei",
    summary: "Liderazgo técnico para despliegue de redes 4G/5G en Europa.",
    details: `Coordinación de un equipo internacional de 30 ingenieros. Gestión de la migración de nodos y aseguramiento de la calidad (QA) en las entregas a clientes tier-1 como Vodafone y Orange.`,
    year: "2019"
  },
  {
    id: "proj-4",
    title: "Ingeniería Aeroespacial",
    category: "consultoria",
    client: "Airbus Crisa",
    summary: "Proyectos de electrónica de potencia para satélites.",
    details: `Participación en el ciclo de vida completo del hardware de vuelo (Ariane 6). Diseño de bancos de pruebas automáticos y validación de requisitos críticos de misión.`,
    year: "2018"
  },
  {
    id: "proj-5",
    title: "Web Emotion",
    category: "desarrollo",
    client: "Airbus Crisa",
    summary: "Proyectos de electrónica de potencia para satélites.",
    details: `Participación en el ciclo de vida completo del hardware de vuelo (Ariane 6). Diseño de bancos de pruebas automáticos y validación de requisitos críticos de misión.`,
    year: "2018"
  }
];

// EXPERIENCIA (Añadido campo 'details')
const experience = [
  {
    id: "exp-1",
    role: "Responsable Unidad Ciberseguridad",
    company: "Alcorce Telecomunicaciones",
    summary: "Creación y estrategia de la unidad de negocio.",
    details: `Definición del portfolio de servicios de ciberseguridad gestionada. Establecimiento de alianzas estratégicas con fabricantes líderes (Fortinet, Palo Alto). 
    
    Responsable de la cuenta de resultados (P&L) de la unidad y liderazgo del equipo técnico y preventa.`,
    year: "2022 — Hoy"
  },
  {
    id: "exp-2",
    role: "Gerente de Ciberseguridad",
    company: "Babel",
    summary: "Gestión de servicios SOC y consultoría GRC.",
    details: `Supervisión operativa del Centro de Operaciones de Seguridad (SOC). Gestión de proyectos de consultoría normativa (GDPR, ISO 27001) para clientes del sector bancario y seguros.`,
    year: "2021 — 2022"
  },
  {
    id: "exp-3",
    role: "Responsable Unidad Telco",
    company: "ALTEN Spain",
    summary: "Gestión de operaciones y desarrollo de negocio.",
    details: `Management de un equipo de +35 consultores en clientes operadores. Desarrollo de carrera del equipo, contratación y gestión financiera de los proyectos.`,
    year: "2018 — 2021"
  }
];

const certifications = [
  {
    name: "Certified in Cybersecurity (CC)",
    issuer: "ISC2",
    year: "2023",
    url: "https://www.isc2.org/certifications/cc"
  },
  {
    name: "Cybersecurity Essentials",
    issuer: "Cisco",
    year: "2023",
    url: "#"
  },
  {
    name: "PACSP (Professional Accredited Cloud Security)",
    issuer: "Proofpoint",
    year: "2023",
    url: "#"
  },
  {
    name: "Certified Fundamentals Cybersecurity",
    issuer: "Fortinet",
    year: "2023",
    url: "#"
  },
  {
    name: "NSE 1 & NSE 2 Network Security Associate",
    issuer: "Fortinet",
    year: "2022",
    url: "#"
  },
  {
    name: "Security Architecture for Account Managers",
    issuer: "Cisco",
    year: "2018",
    url: "#"
  },
  {
    name: "CCDA - Certified Design Associate",
    issuer: "Cisco",
    year: "2017",
    url: "#"
  }
];

// 3. LÓGICA DEL BLOG (Aquí es donde se define latestPosts)
let latestPosts = [];
try {
  const allPosts = await getCollection('blog');
  // Ordenamos por fecha y cogemos los 2 últimos
  latestPosts = allPosts
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 2);
} catch (e) {
  console.log("No se encontraron posts o la colección 'blog' no existe aún.");
}
---

<Layout title="Enrique Relucio - Consultor" showHeader={false}>
	
		
		<header class="flex flex-col gap-6">
			<div class="flex items-start gap-6">
				
				<div class="shrink-0 h-25 w-25 bg-zinc-100 dark:bg-zinc-800 rounded-2xl overflow-hidden border border-zinc-200 dark:border-zinc-700 shadow-sm">
					<img src="Logo_ER_B&W.png" alt="Enrique Relucio" class="object-cover w-full h-full opacity-90 hover:opacity-100 transition-opacity" />
				</div>

				<div class="flex flex-col gap-2"> <h1 class="text-3xl font-medium tracking-tight text-zinc-900 dark:text-zinc-50 sm:text-4xl">
						Enrique Relucio
					</h1>
					<p class="text-[16px] leading-relaxed text-zinc-600 dark:text-zinc-400">
						Ingeniero de Telecomunicación especializado en <span class="text-zinc-900 dark:text-zinc-100 font-medium">Ciberseguridad</span> y Desarrollo de Negocio.
					</p>
				</div>
			
			</div>

            <nav class="flex gap-4">
                <a href="/blog" class="text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 transition-colors border-b border-transparent hover:border-zinc-400">Blog</a>
                <a href="/#proyectos" class="text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 transition-colors border-b border-transparent hover:border-zinc-400">
                  Proyectos
                </a>
                <a href="/#experiencia" class="text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 transition-colors border-b border-transparent hover:border-zinc-400">
                  Experiencia
                </a>
                <a href="/sobre-mi" class="text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 transition-colors border-b border-transparent hover:border-zinc-400">
                  Sobre mi
                </a>
                <a href="https://linkedin.com/in/enriquerelucio" target="_blank" class="text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 transition-colors border-b border-transparent hover:border-zinc-400">LinkedIn</a>
                <a href="mailto:contacto@relucio.es" class="text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 transition-colors border-b border-transparent hover:border-zinc-400">Contacto</a>
            </nav>
		</header>

        {latestPosts.length > 0 && (
            <Section title="Artículos Recientes">
                <div class="flex flex-col">
                    {latestPosts.map((post) => (
                        <BlogRow 
                          title={post.data.title}
                          date={post.data.pubDate}
                          url={`/blog/${post.slug}/`}
                          category={post.data.category} 
                          tags={post.data.tags}  
                          image={post.data.heroImage}
                        />
                    ))}
                </div>
            </Section>
        )}

		<Section title="Proyectos Seleccionados" id="proyectos">
    
    <div class="flex gap-2 mb-8 overflow-x-auto pb-2">
        <button 
            class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900" 
            data-filter="todos"
        >
            Todos
        </button>
        <button 
            class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-zinc-100 text-zinc-600 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:hover:bg-zinc-700" 
            data-filter="consultoria"
        >
            Consultoría
        </button>
        <button 
            class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-zinc-100 text-zinc-600 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:hover:bg-zinc-700" 
            data-filter="desarrollo"
        >
            Desarrollo
        </button>
    </div>

    <div class="flex flex-col gap-0"> {projects.map((project) => (
            /* Envolvemos el componente en un div con el atributo data-category */
            <div class="project-item transition-all duration-300" data-category={project.category}>
                <ExpandableItem 
                    id={project.id}
                    title={project.title}
                    subtitle={`Cliente: ${project.client}`}
                    summary={project.summary}
                    details={project.details}
                    year={project.year}
                />
            </div>
        ))}
    </div>

</Section>

        <Section title="Trayectoria" id="experiencia">
      <div class="flex flex-col">
        {experience.map((job) => (
          <ExpandableItem 
            id={job.id}
            title={job.role}
            subtitle={job.company}
            summary={job.summary}
            details={job.details}
            year={job.year}
          />
        ))}
      </div>
    </Section>

        <Section title="Certificaciones">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {certifications.map((cert) => (
                    <a 
                        href={cert.url} 
                        target="_blank"
                        class="flex flex-col gap-1 p-3 -mx-3 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors border border-transparent hover:border-zinc-200 dark:hover:border-zinc-800 group"
                    >
                        <div class="flex justify-between items-start w-full">
                            <h3 class="font-medium text-zinc-900 dark:text-zinc-100 text-sm">
                                {cert.name}
                            </h3>
                            <span class="text-zinc-400 text-xs font-mono tabular-nums shrink-0 ml-2">
                                {cert.year}
                            </span>
                        </div>
                        <span class="text-xs text-zinc-500 dark:text-zinc-500">
                            Emitido por <span class="text-zinc-700 dark:text-zinc-300 font-medium">{cert.issuer}</span>
                        </span>
                    </a>
                ))}
            </div>
        </Section>

	
</Layout>

<script>
    // Esperamos a que el DOM esté listo
    document.addEventListener('DOMContentLoaded', () => {
        const buttons = document.querySelectorAll('.filter-btn');
        const items = document.querySelectorAll('.project-item');

        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                // 1. Gestionar estilos de los botones (Activo/Inactivo)
                buttons.forEach(b => {
                    // Quitamos estilo activo (negro/blanco) y ponemos estilo inactivo (gris)
                    b.classList.remove('bg-zinc-900', 'text-white', 'dark:bg-zinc-100', 'dark:text-zinc-900');
                    b.classList.add('bg-zinc-100', 'text-zinc-600', 'dark:bg-zinc-800', 'dark:text-zinc-400');
                });
                
                // Ponemos estilo activo al botón pulsado
                btn.classList.remove('bg-zinc-100', 'text-zinc-600', 'dark:bg-zinc-800', 'dark:text-zinc-400');
                btn.classList.add('bg-zinc-900', 'text-white', 'dark:bg-zinc-100', 'dark:text-zinc-900');

                // 2. Filtrar los elementos
                const filterValue = btn.getAttribute('data-filter');

                items.forEach((item) => {
                    const itemCategory = item.getAttribute('data-category');
                    
                    // Si es 'todos' o coincide la categoría, mostramos. Si no, ocultamos.
                    if (filterValue === 'todos' || itemCategory === filterValue) {
                        (item as HTMLElement).style.display = 'block';
                        // Pequeño timeout para animación de opacidad si quisieras
                        setTimeout(() => (item as HTMLElement).style.opacity = '1', 10);
                    } else {
                        (item as HTMLElement).style.display = 'none';
                        (item as HTMLElement).style.opacity = '0';
                    }
                });
            });
        });
    });
</script>